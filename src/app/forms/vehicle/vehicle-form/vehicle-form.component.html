<form
  [formGroup]="form"
  (keydown.enter)="onEnter($event)"
>
  @if (dataForm?.plate) {
    <div class="title-trash">
      <h2>Veículo placa: {{ dataForm!.plate }}</h2>
    </div>
  }

  <app-wrapper-card>
    <!-- Origem do veículo -->
    <div class="radio-button-wrapper-container">
      <label class="radio-button-label">Origem:</label>
      <mat-radio-group
        color="primary"
        formControlName="origin"
        aria-label="Select an option"
        class="radio-button-group"
      >
        <mat-radio-button
          class="radio-button"
          value="NACIONAL"
        >
          Nacional
        </mat-radio-button>
        <mat-radio-button
          class="radio-button"
          value="IMPORTADO"
        >
          Importado
        </mat-radio-button>
      </mat-radio-group>
    </div>

    <!-- Placa (obrigatório) -->
    <app-primary-input
      formControlName="plate"
      label="Placa*"
      inputName="plate"
      type="text"
      mask="AAA-AAAA"
      [error]="
        form.get('plate')?.invalid && (form.get('plate')?.touched || submitted)
      "
    />

    <!-- Seleção de Proprietário -->
    <div class="custom-selects-container">
      <app-custom-select
        listType="person"
        [label]="'Proprietário'"
        [options]="persons"
        [control]="ownerControl"
        placeholder="Selecione um proprietário"
        matTooltip="Selecione o proprietário do veículo"
        (onCreateNew)="onCreateNewPerson()"
        (onEdit)="onEditPerson($event)"
      ></app-custom-select>
    </div>

    <!-- Seleção de Marca -->
    <div class="custom-selects-container">
      <app-custom-select
        listType="brand"
        [label]="'Marca'"
        [options]="brands"
        [control]="brandControl"
        placeholder="Selecione uma marca"
        matTooltip="Selecione a marca do veículo"
      ></app-custom-select>
    </div>

    <!-- Seleção de Modelo (habilitado apenas após selecionar marca) -->
    <div class="custom-selects-container">
      <app-custom-select
        listType="model"
        [label]="'Modelo'"
        [options]="models"
        [control]="modelControl"
        [placeholder]="
          selectModelDisabled()
            ? 'Selecione uma marca primeiro'
            : 'Selecione um modelo'
        "
        [disabled]="selectModelDisabled()"
        [selectedBrand]="brandControl.value"
        matTooltip="Selecione o modelo do veículo"
      ></app-custom-select>
    </div>

    <!-- Seleção de Cor -->
    <div class="custom-selects-container">
      <app-custom-select
        listType="color"
        [label]="'Cor'"
        [options]="colors"
        [control]="colorControl"
        placeholder="Selecione uma cor"
        matTooltip="Selecione a cor do veículo"
      ></app-custom-select>
    </div>

    <!-- Tipos de Combustível (múltipla seleção) -->
    <app-primary-select
      formControlName="fuelTypes"
      label="Tipos de Combustível"
      inputName="fuelTypes"
      placeholder="Selecione os tipos de combustível"
      [options]="fuelTypesOptions"
      [allowMultiple]="false"
      optionValue="value"
      optionLabel="label"
    ></app-primary-select>

    <!-- Ano -->
    <app-primary-input
      formControlName="vehicleYear"
      label="Ano Fabricação"
      inputName="vehicleYear"
      type="text"
      placeholder="0000"
      mask="0000"
    />

    <!-- Ano/Modelo -->
    <app-primary-input
      formControlName="modelYear"
      label="Ano Modelo"
      inputName="modelYear"
      type="text"
      placeholder="0000"
      mask="0000"
    />

    <!-- Chassi -->
    <app-primary-input
      formControlName="chassis"
      label="Chassi"
      inputName="chassis"
      type="text"
      placeholder="Insira os 17 caracteres do chassi"
      mask="AAAAAAAAAAAAAAAAA"
    />

    <!-- Número de portas -->
    <app-primary-input
      formControlName="doors"
      label="Número de portas"
      inputName="doors"
      type="text"
    />

    <!-- Potência -->
    <app-primary-input
      formControlName="horsepower"
      label="Potência"
      inputName="horsepower"
      type="text"
    />

    <!-- Número do motor -->
    <app-primary-input
      formControlName="engineNumber"
      label="Número do motor"
      inputName="engineNumber"
      type="text"
      placeholder="Digite o Número do Motor"
      mask="AAAAAAAAAAAAAAAAAAAA"
    />

    <!-- KM inicial -->
    <app-primary-input
      formControlName="km"
      label="KM inicial"
      inputName="km"
      type="text"
    />

    <!-- Renavam -->
    <app-primary-input
      formControlName="renavam"
      label="Renavam"
      inputName="renavam"
      type="text"
    />

    <!-- Espécie -->
    <app-primary-input
      formControlName="species"
      label="Espécie"
      inputName="species"
      type="text"
    />

    <!-- Categoria -->
    <app-primary-input
      formControlName="category"
      label="Categoria"
      inputName="category"
      type="text"
    />

    <!-- Tipo de Veículo -->
    <app-primary-input
      formControlName="vehicleType"
      label="Tipo de Veículo"
      inputName="vehicleType"
      type="text"
    />

    <!-- Características -->
    <app-primary-input
      formControlName="features"
      label="Características"
      inputName="features"
      type="text"
    />
  </app-wrapper-card>

  <!-- Botão de submit -->
  <button
    mat-raised-button
    type="button"
    class="submit-btn"
    color="primary"
    (click)="onSubmit()"
    #submitButton
  >
    {{ dataForm?.plate ? 'Editar' : 'Enviar' }}
  </button>
</form>

<!-- Drawer para criar/editar pessoa -->
@if (openPersonForm()) {
  <app-drawer (closeDrawer)="handleClosePersonDrawer()">
    <mat-tab-group [selectedIndex]="selectedPersonToEdit?.legalEntity ? 1 : 0">
      <mat-tab
        label="Pessoa Física"
        [disabled]="selectedPersonToEdit && selectedPersonToEdit.legalEntity"
      >
        <app-natural-person-form
          [dataForm]="
            !selectedPersonToEdit?.legalEntity ? selectedPersonToEdit : null
          "
          (formSubmitted)="onPersonFormSubmitted()"
        />
      </mat-tab>
      <mat-tab
        label="Pessoa Jurídica"
        [disabled]="selectedPersonToEdit && !selectedPersonToEdit.legalEntity"
      >
        <app-legal-entity-form
          [dataForm]="
            selectedPersonToEdit?.legalEntity ? selectedPersonToEdit : null
          "
          (formSubmitted)="onPersonFormSubmitted()"
        />
      </mat-tab>
    </mat-tab-group>
  </app-drawer>
}
