<form [formGroup]="form" (keydown.enter)="onEnter($event)">
  <!-- Seção: Dados da Empresa -->
  <app-wrapper-card title="Dados da empresa">
    
    <!-- 
      Layout: Nome da Empresa (50%) + Tipo (50%)
      Proporção equilibrada
    -->
    <div class="form-row-2cols">
      <app-primary-input
        formControlName="name"
        label="Nome da Empresa (Razão Social) *"
        inputName="name"
        type="text"
        [error]="
          form.get('name')?.invalid &&
          (form.get('name')?.touched || submitted)
        "
      />
      
      <app-primary-select
        label="Tipo *"
        placeholder="Selecione"
        inputName="relationshipTypes"
        [allowMultiple]="true"
        formControlName="relationshipTypes"
        [error]="submitted && form.get('relationshipTypes')?.invalid"
      ></app-primary-select>
    </div>

    <!-- Mensagem de erro para relationshipTypes -->
    @if (submitted && form.get('relationshipTypes')?.invalid) {
    <div class="error-message">
      Selecione pelo menos um tipo de relacionamento
    </div>
    }

    <!-- 
      Layout: CNPJ + Nome Fantasia (2 campos em uma linha - 50% cada)
      Campos de identificação da empresa agrupados em pares
    -->
    <div class="form-row-2cols">
      <app-primary-input
        formControlName="cnpj"
        label="CNPJ"
        inputName="cnpj"
        type="text"
        placeholder="00.000.000/0000-00"
        mask="00.000.000/0000-00"
        appCnpjValidator
        [error]="
          form.get('cnpj')?.invalid &&
          (form.get('cnpj')?.touched || submitted)
        "
      />

      <app-primary-input
        formControlName="nickName"
        label="Nome Fantasia"
        inputName="nickName"
        type="text"
        placeholder="Nome comercial"
      />
    </div>

    <!-- 
      Layout: Inscrição Estadual + CRC (2 campos em uma linha - 50% cada)
      Documentos secundários agrupados
    -->
    <div class="form-row-2cols">
      <app-primary-input
        formControlName="ie"
        label="Inscrição Estadual"
        inputName="ie"
        type="text"
        placeholder="Nº da IE"
      />
      
      <app-primary-input
        formControlName="crc"
        label="CRC (se aplicável)"
        inputName="crc"
        type="text"
        placeholder="Nº do CRC"
      />
    </div>

    <!-- 
      Layout: Email + Telefone (2 campos em uma linha - 50% cada)
      Dados de contato agrupados
    -->
    <div class="form-row-2cols">
      <app-primary-input
        formControlName="email"
        label="Email"
        inputName="email"
        type="email"
        placeholder="exemplo@empresa.com"
        [error]="
          form.get('email')?.invalid &&
          (form.get('email')?.touched || submitted)
        "
      />
      
      <app-primary-input
        formControlName="phone"
        label="Telefone/Celular"
        inputName="phone"
        type="tel"
        placeholder="(00) 00000-0000"
        mask="(00) 00000-0000"
      />
    </div>

  </app-wrapper-card>

  <!-- 
    Seção condicional: Dados de Acesso ao Sistema
    Só aparece para FUNCIONARIO, PROPRIETARIO ou CONTADOR
  -->
  @if (shouldShowUserFields) {
  <app-wrapper-card title="Dados de Acesso ao Sistema">
    
    <!-- 
      Layout: Nome de Usuário + Função (2 campos - 50% cada)
      Primeira linha de dados de acesso
    -->
    <div class="form-row-2cols">
      <app-primary-input
        formControlName="username"
        label="Nome de usuário *"
        inputName="username"
        type="text"
        [uppercase]="false"
        placeholder="Digite o nome de usuário"
        [error]="
          form.get('username')?.invalid &&
          (form.get('username')?.touched || submitted)
        "
      />

      <app-primary-select
        label="Função no Sistema *"
        placeholder="Selecione a função"
        inputName="roleName"
        formControlName="roleName"
        [error]="submitted && form.get('roleName')?.invalid"
        [options]="[
          { value: 'ROLE_MANAGER', label: 'Gerente' },
          { value: 'ROLE_SELLER', label: 'Vendedor' },
          { value: 'ROLE_FINANCIAL', label: 'Financeiro' }
        ]"
      />
    </div>

    <!-- 
      Layout: Senha + Confirmar Senha (2 campos - 50% cada)
      Segunda linha de dados de acesso
    -->
    <div class="form-row-2cols">
      <app-primary-input
        formControlName="password"
        label="Senha *"
        inputName="password"
        type="password"
        [uppercase]="false"
        placeholder="Mínimo 6 caracteres"
        [error]="
          form.get('password')?.invalid &&
          (form.get('password')?.touched || submitted)
        "
      />

      <app-primary-input
        formControlName="confirmPassword"
        label="Confirmar Senha *"
        inputName="confirmPassword"
        type="password"
        [uppercase]="false"
        placeholder="Digite a senha novamente"
        [error]="
          (form.get('confirmPassword')?.invalid ||
          form.errors?.['passwordMismatch']) &&
          (form.get('confirmPassword')?.touched || submitted)
        "
      />
    </div>

    <!-- Mensagem de erro para senhas não coincidentes -->
    @if (submitted && form.errors?.['passwordMismatch']) {
    <div class="error-message">
      As senhas não coincidem
    </div>
    }

    <!-- Mensagens de erro consolidadas -->
    @if (submitted && form.get('username')?.invalid) {
    <div class="error-message">
      Nome de usuário é obrigatório (mínimo 3 caracteres)
    </div>
    }

    @if (submitted && form.get('password')?.invalid) {
    <div class="error-message">
      Senha é obrigatória (mínimo 6 caracteres)
    </div>
    }

    @if (submitted && form.get('confirmPassword')?.invalid && !form.errors?.['passwordMismatch']) {
    <div class="error-message">
      Confirmação de senha é obrigatória (mínimo 6 caracteres)
    </div>
    }

    @if (submitted && form.get('roleName')?.invalid) {
    <div class="error-message">
      Selecione uma função no sistema
    </div>
    }
  </app-wrapper-card>
  }

  <!--
    Seção de Endereço (comentada)
    Quando for habilitada, também usa o layout otimizado
  -->
  <!--
  <app-wrapper-card title="Endereço">
    <div formGroupName="address">
      
      Layout sugerido: CEP (40%) + Rua (60%)
      <div class="form-row">
        <div class="col-40">
          <app-primary-input
            formControlName="zipcode"
            label="CEP"
            inputName="zipcode"
            placeholder="00000-000"
            mask="00000-000"
            type="text"
            [error]="
              form.get('address.zipcode')?.invalid &&
              (form.get('address.zipcode')?.touched || submitted)"
          >
            <button class="search-icon-btn" (click)="getAddressByCep()" [disabled]="!isCepValid()" [class.is-active]="isCepValid()">
              <mat-icon class="search-icon">search</mat-icon>
            </button>
          </app-primary-input>
        </div>

        <div class="col-60">
          <app-primary-input
            formControlName="street"
            label="Rua"
            inputName="street"
            type="text"
          ></app-primary-input>
        </div>
      </div>

      Layout: Número + Complemento (2 campos - 50% cada)
      <div class="form-row-2cols">
        <app-primary-input
          formControlName="number"
          label="Número"
          inputName="number"
          type="text"
        ></app-primary-input>

        <app-primary-input
          formControlName="complement"
          label="Complemento"
          inputName="complement"
          type="text"
        ></app-primary-input>
      </div>

      Layout: Bairro + Cidade (2 campos - 50% cada)
      <div class="form-row-2cols">
        <app-primary-input
          formControlName="neighborhood"
          label="Bairro"
          inputName="neighborhood"
          type="text"
        ></app-primary-input>

        <app-primary-input
          formControlName="city"
          label="Cidade"
          inputName="city"
          type="text"
        ></app-primary-input>
      </div>

      Layout: Estado (última linha)
      <app-primary-input
        formControlName="state"
        label="Estado"
        inputName="state"
        type="text"
      ></app-primary-input>

    </div>
  </app-wrapper-card>
  -->

  <!-- Botão de submit -->
  <button
    mat-raised-button
    type="button"
    class="submit-btn"
    (click)="onSubmit()"
    #submitButton
  >
    Salvar
  </button>
</form>
