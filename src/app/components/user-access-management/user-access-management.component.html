<div class="access-container">
  @if (hasUser) {
    <div class="access-status active">
      <mat-icon class="status-icon">check_circle</mat-icon>
      <div class="status-info">
        <h4>Acesso Ativo</h4>
        <p>Esta pessoa possui usuário de sistema vinculado.</p>
        @if (existingUsername) {
          <small>
            Usuário:
            <strong>{{ existingUsername }}</strong>
          </small>
        }
      </div>
      <!-- Future: Add 'Redefinir Senha' button here -->
    </div>
  } @else {
    <div class="access-status inactive">
      <mat-icon class="status-icon">lock</mat-icon>
      <div class="status-info">
        <h4>Sem Acesso ao Sistema</h4>
        <p>Esta pessoa não possui login/senha cadastrados.</p>
      </div>
      <button
        mat-flat-button
        color="primary"
        (click)="toggleForm()"
        *ngIf="!isFormVisible"
      >
        <mat-icon>add_moderator</mat-icon>
        Criar Acesso
      </button>
    </div>

    @if (isFormVisible) {
      <mat-card
        appearance="outlined"
        class="form-card"
      >
        <mat-card-header>
          <mat-card-title>Novo Usuário de Sistema</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <form
            [formGroup]="userForm"
            (ngSubmit)="onSubmit()"
          >
            <!-- Reusable Access Data Form -->
            <app-access-data-form
              [form]="userForm"
              [submitted]="submitted"
            ></app-access-data-form>

            <div class="form-actions">
              <button
                mat-button
                type="button"
                (click)="toggleForm()"
              >
                Cancelar
              </button>
              <button
                mat-flat-button
                color="primary"
                type="submit"
                [disabled]="isLoading || userForm.invalid"
              >
                @if (isLoading) {
                  Saving...
                } @else {
                  Salvar Acesso
                }
              </button>
            </div>
          </form>
        </mat-card-content>
      </mat-card>
    }
  }
</div>
