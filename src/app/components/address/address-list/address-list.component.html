<div class="address-list-container">
  <!-- Header -->
  <div class="list-header">
    <div class="header-title">
      <mat-icon>location_on</mat-icon>
      <h3>Endereços</h3>
      <span
        class="count-badge"
        *ngIf="addressCount > 0"
      >
        {{ addressCount }}
      </span>
    </div>

    <mat-form-field
      appearance="outline"
      class="header-draft-select"
      subscriptSizing="dynamic"
      *ngIf="availableDrafts.length > 0"
    >
      <mat-select
        placeholder="Continuar Cadastro"
        [value]="selectedDraft"
        (selectionChange)="handleDraftSelection($event.value)"
        panelClass="header-draft-panel"
      >
        <mat-option [value]="null">Selecione o rascunho</mat-option>
        <mat-option
          *ngFor="let draft of availableDrafts"
          [value]="draft"
          class="draft-option-item"
        >
          <span class="draft-text">
            {{ draft.draftName || 'Sem nome' }} -
            {{ draft.lastModified | date: 'dd/MM HH:mm' }}
          </span>
          <button
            mat-icon-button
            (click)="removeDraft(draft, $event)"
            matTooltip="Excluir rascunho"
          >
            <mat-icon color="warn">delete</mat-icon>
          </button>
        </mat-option>
      </mat-select>
    </mat-form-field>

    <button
      mat-raised-button
      color="primary"
      *ngIf="canAdd && !showForm"
      (click)="onAddNew()"
      class="btn-add"
    >
      <mat-icon>add</mat-icon>
      Adicionar Endereço
    </button>
  </div>

  <!-- Formulário (quando visível) -->
  <div
    class="form-container"
    *ngIf="showForm"
    #formContainer
  >
    <app-address-form
      [personId]="personId"
      [address]="editingAddress"
      [initialDraftId]="selectedDraftId"
      (formSubmitted)="onFormSubmitted()"
      (formCancelled)="onFormCancelled()"
    ></app-address-form>
  </div>

  <!-- Loading -->
  <div
    class="loading-container"
    *ngIf="loading"
  >
    <mat-icon class="spinner">hourglass_empty</mat-icon>
    <p>Carregando endereços...</p>
  </div>

  <!-- Lista de Endereços -->
  <div
    class="addresses-grid"
    *ngIf="!loading && !showForm && addresses.length > 0"
  >
    <app-address-card
      *ngFor="let address of addresses"
      [address]="address"
      [canEdit]="canEdit"
      [canDelete]="canDelete"
      [canSetMain]="true"
      (edit)="onEdit($event)"
      (delete)="onDelete($event)"
      (setMain)="onSetMain($event)"
    ></app-address-card>
  </div>

  <!-- Empty State -->
  <div
    class="empty-state"
    *ngIf="!loading && !showForm && addresses.length === 0"
  >
    <mat-icon>location_off</mat-icon>
    <h4>Nenhum endereço cadastrado</h4>
    <p>Adicione um endereço para esta pessoa</p>
    <button
      mat-raised-button
      color="primary"
      *ngIf="canAdd"
      (click)="onAddNew()"
    >
      <mat-icon>add</mat-icon>
      Adicionar Primeiro Endereço
    </button>
  </div>

  <!-- Info sobre endereço principal -->
  <div
    class="info-message"
    *ngIf="!loading && addresses.length > 0 && !hasMainAddress"
  >
    <mat-icon>info</mat-icon>
    <span>
      Nenhum endereço está marcado como principal. Considere definir um endereço
      principal.
    </span>
  </div>
</div>
