<h2 mat-dialog-title>Vincular Propriet치rio</h2>

<mat-dialog-content>
  @if (loading) {
    <div class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Carregando pessoas...</p>
    </div>
  } @else if (error) {
    <div class="error-container">
      <p>Erro ao carregar pessoas. Tente novamente.</p>
    </div>
  } @else if (persons.length === 0) {
    <div class="empty-container">
      <p>Nenhuma pessoa ativa cadastrada nesta loja.</p>
      <p class="hint">Cadastre uma pessoa primeiro para vincul치-la como propriet치ria.</p>
    </div>
  } @else {
    <form [formGroup]="ownerForm" class="owner-form">
      
      <div class="info-box">
        <p><strong>Loja:</strong> {{ data.store.name }}</p>
        @if (data.store.owner) {
          <p class="warning">丘멆잺 Esta loja j치 possui um propriet치rio vinculado.</p>
        }
      </div>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Selecione a pessoa</mat-label>
        <mat-select formControlName="personId">
          @for (person of persons; track person.personId) {
            <mat-option [value]="person.personId">
              {{ getPersonDisplay(person) }}
            </mat-option>
          }
        </mat-select>
        @if (ownerForm.get('personId')?.invalid && ownerForm.get('personId')?.touched) {
          <mat-error>Selecione uma pessoa</mat-error>
        }
      </mat-form-field>

      <div class="hint-text">
        <p>游눠 Apenas pessoas ativas desta loja podem ser vinculadas como propriet치rias.</p>
        <p>丘멆잺 Uma vez vinculado, n칚o ser치 poss칤vel remover ou alterar o propriet치rio.</p>
      </div>

    </form>
  }
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">Cancelar</button>
  @if (!loading && !error && persons.length > 0) {
    <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="ownerForm.invalid || data.store.owner">
      Vincular Propriet치rio
    </button>
  }
</mat-dialog-actions>
