<div class="custom-dropdown" [class.disabled]="disabled">
  <span class="label">
    {{ label }}
  </span>

  <div class="dropdown-container">
    <button class="dropdown-button" (click)="toggleDropdown()">
      {{ selectedOption?.name || placeholder }}
      <span class="dropdown-arrow"></span>
      <span class="vertical-bar"></span>
    </button>

    <!-- Dropdown Menu com busca -->
    <div class="dropdown-menu" [class.open]="isOpen" [class.closed]="!isOpen" (mouseleave)="onMouseLeaveDropdown($event)">
      
      <!-- Campo de busca -->
      <div class="search-container" (click)="$event.stopPropagation()">
        <mat-icon class="search-icon">search</mat-icon>
        <div class="input-wrapper">
          <input
            type="text"
            class="search-input"
            [(ngModel)]="searchTerm"
            (input)="onSearch()"
            placeholder="Digite para buscar..."
            (keydown.enter)="$event.preventDefault()"
            aria-label="Campo de busca"
          />
        </div>
        @if (searchTerm) {
          <mat-icon 
            class="clear-icon" 
            (click)="clearSearch()"
            aria-label="Limpar busca"
            role="button"
            tabindex="0"
          >
            close
          </mat-icon>
        }
      </div>

      <!-- Lista com scroll -->
      <ul class="options-list">
        @if (filteredOptions.length > 0) {
          @for (option of filteredOptions; track option.id) {
            <li (click)="selectOption(option)">
              <span>{{ option.name }}</span>
              <div class="select_list_buttons">
                <button class="edit-button" (click)="editItem(option, $event)">
                  ✏️
                </button>
                <button class="delete-button" (click)="deleteItem(option, $event)">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </li>
          }
        } @else {
          <li class="no-results">
            <span>Nenhum resultado encontrado</span>
          </li>
        }
      </ul>

      <!-- Loading indicator -->
      @if (isLoading) {
        <div class="loading-container">
          <mat-icon class="loading-spinner">refresh</mat-icon>
          <span>Carregando...</span>
        </div>
      }
    </div>

    <mat-icon [matTooltip]="matTooltip" (click)="createNewItem()">
      add_box
    </mat-icon>
  </div>
</div>
